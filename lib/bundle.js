!function(t){var s={};function e(i){if(s[i])return s[i].exports;var o=s[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,e),o.l=!0,o.exports}e.m=t,e.c=s,e.d=function(t,s,i){e.o(t,s)||Object.defineProperty(t,s,{enumerable:!0,get:i})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,s){if(1&s&&(t=e(t)),8&s)return t;if(4&s&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(e.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&s&&"string"!=typeof t)for(var o in t)e.d(i,o,function(s){return t[s]}.bind(null,o));return i},e.n=function(t){var s=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(s,"a",s),s},e.o=function(t,s){return Object.prototype.hasOwnProperty.call(t,s)},e.p="",e(e.s=0)}([function(t,s,e){"use strict";e.r(s);var i=class{constructor(t,s,e){this.image=t,this.name=t.name,this.x=500*Math.random()+50,this.y=260*Math.random()+90,this.value=this.calcValue(t),this.slowdown=t.slowdown,this.collected=!1,this.index=s,this.here=!0,this.game=e,this.stagger=this.index%2?1.5*(this.index%3+1):-1.5*(this.index%3+1)}calcValue(t){return Math.round(Math.random()*t.multiplier)+t.baseValue}collect(){if(this.x=this.game.x2-this.stagger,this.y=this.game.y2-.8*this.stagger,this.here&&this.y<95&&this.x>235&&this.x<345)return this.here=!1,this.game.coins[this.index]=void 0}handleCollection(t){if(t[0]+4>this.x&&t[0]<this.x+24&&t[1]+4>this.y&&t[1]<this.y+24)return this.collect(),this.collected=!0,!0}};var o=()=>{window.addEventListener("keydown",t=>{[37,38,39,40].indexOf(t.keyCode)>-1&&t.preventDefault()},!1)};var a=class{constructor(t,s){this.music=document.createElement("audio"),this.music.src=t,this.music.setAttribute("preload","auto"),this.music.setAttribute("controls","none"),s||this.music.setAttribute("loop","true"),this.music.style.display="none",document.body.appendChild(this.music)}play(){this.music.play()}pause(){this.music.pause()}};const h=new Image;h.src="./assets/images/magnet.png";const n=new Image;n.multiplier=120,n.baseValue=80,n.slowdown=5,n.name="bitcoin",n.src="./assets/images/bitcoin.png";const r=new Image;r.multiplier=40,r.baseValue=30,r.slowdown=2.3,r.name="tron",r.src="./assets/images/tron.png";const c=new Image;c.multiplier=0,c.baseValue=.01,c.slowdown=1.3,c.name="penny",c.src="./assets/images/penny.png";var l={magnet:h,bitcoin:n,tron:r,penny:c};var d=class{constructor(t,s,e){this.canvas=s,this.ctx=t,this.game=e,this.points=[],this.rotate=!0,this.forward=!0,this.rotationDiff=0,this.angle=1,this.rotation=130,this.x=0,this.y=0,this.translateX=s.width/2,this.dy=6,this.dx=6,this.maxReach=225,this.sound=new a("./assets/audio/sliding.mp3",!0),this.initialMove=!0}drawmagnet(){this.rotate?this.drawRotatingMagnet():this.drawMovingMagnet()}drawMovingMagnet(){this.returnedToStart()||(this.calculateMaxReach(),this.drawString(),this.calculateCoorOnCanvas(),this.generateMagneticPoints(),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),(this.x+this.dx>this.maxReach||this.y+this.dy>this.maxReach)&&(this.dx=-this.dx,this.dy=-this.dy),this.ctx.translate(this.translateX,50),this.ctx.rotate(this.angle),this.x+=this.dx,this.y+=this.dy,this.ctx.drawImage(l.magnet,this.x,this.y),this.ctx.restore())}generateMagneticPoints(){this.points=[];for(let t=0;t<2*Math.PI;t+=Math.PI/10){const s=this.game.x2+33*Math.cos(t),e=this.game.y2+33*Math.sin(t);this.points.push([s,e])}this.points.forEach(t=>{this.ctx.fillStyle="green",this.ctx.fillRect(t[0]+5*Math.random(),t[1]+5*Math.random(),3,3)})}calculateCoorOnCanvas(){this.game.l=Math.sqrt(this.x**2+this.y**2)+l.magnet.height/2+10,this.game.x2=this.translateX+this.game.l*Math.cos(this.angle+.785398),this.game.y2=50+this.game.l*Math.sin(this.angle+.785398)}calculateMaxReach(){const t=this.rotation-this.rotationDiff;this.maxReach=t<=90&&t>=0?Math.abs(t-45)+210:t>90?250-2*(t-90):250+2*t}returnedToStart(){if(this.y<=0&&this.dy<0)return this.rotate=!0,this.handleCollectedCoins(),this.dx=6,this.dy=6,this.initialMove=!0,this.sound.pause(),!0}handleCollectedCoins(){for(;this.game.collected.length>0;)this.game.names.length>1?setTimeout(()=>{this.game.flashMessage(this.game.names.map(t=>"+"+t)),this.game.names=[]},300):this.game.flashMessage("+"+this.game.names.pop()),this.game.money+=this.game.collected.pop()}drawRotatingMagnet(){6===this.dx&&6===this.dy||(this.dx=6,this.dy=6),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.angle=(this.rotation-this.rotationDiff)*Math.PI/180,this.ctx.translate(this.translateX,this.y+50),this.ctx.rotate(this.angle),this.ctx.drawImage(l.magnet,0,0),this.ctx.restore(),this.handleRotate()}handleRotate(){this.forward?(this.rotationDiff++,175===this.rotationDiff&&(this.forward=!1,this.rotationDiff--)):(this.rotationDiff--,this.rotationDiff<0&&(this.forward=!0,this.rotationDiff++))}handleKeypress(t){"ArrowDown"===t?(this.initialMove&&(this.ctx.playMusic&&this.sound.play(),this.initialMove=!1),this.rotate=!1,this.dx<0&&(this.dx=-this.dx,this.dy=-this.dy,(this.y<15.5||!this.game.collected.length)&&(this.dx=6,this.dy=6))):"ArrowUp"!==t||this.rotate||(this.dx>0?(this.dx=-this.dx,this.dy=-this.dy):this.dx>-2.5?(this.dx=1.05*this.dx,this.dy=1.05*this.dy):this.dx>-5&&(this.dx=1.15*this.dx,this.dy=1.15*this.dy))}drawString(){this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.translate(this.translateX,50),this.ctx.rotate(this.angle),this.ctx.beginPath(),this.ctx.strokeStyle="white",this.ctx.moveTo(0,0),this.ctx.lineTo(this.x,this.y),this.ctx.stroke(),this.ctx.restore()}slowdown(t){const s=this.dx/t,e=this.dy/t;this.dx>0?(this.dx=-s,this.dy=-e):(this.dx=s,this.dy=e)}};class m{constructor(t,s){this.canvas=s,this.ctx=t,this.defaultCoins=[l.penny,l.tron,l.bitcoin],this.round=1,this.money=0,this.time=1800,this.collected=[],this.names=[],this.coins=this.defaultCoins.map((t,s)=>new i(t,s,this)),this.x2,this.y2,this.l,this.gameInterval,this.magnet=new d(t,s,this),this.music=new a("./assets/audio/slowmotion.mp3"),this.pause=!1}play(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.magnet.drawmagnet(),this.playMusic(),this.setScoreboard(),this.checkGameover()}playMusic(){this.ctx.playMusic?this.music.play():this.music.pause()}checkGameover(){this.time<=0?this.gameOver():(this.drawCoins(this.coins),this.advanceRound())}setScoreboard(t){t?($j("#round").empty(),$j("#money").empty(),$j("#time").empty()):($j("#round").html(`Round: ${this.round}`),$j("#money").html(`Money: ${Math.round(100*this.money)/100}`),$j("#time").html(`Time: ${Math.round(this.time--/60)}`))}advanceRound(){if(this.coins.every(t=>void 0===t)&&this.magnet.rotate){this.round+=1,this.time+=960,this.coins=[],this.flashMessage(`Round ${this.round}!`);for(let t=0;t<=this.round+2;t++)if(this.defaultCoins[t])this.coins.push(new i(this.defaultCoins[t],t,this));else if(t%7==0){const s=this.defaultCoins[2];this.coins.push(new i(s,t,this))}else{const s=this.defaultCoins[t%3];this.coins.push(new i(s,t,this))}}}flashMessage(t){const s=$j(".flash-message");Array.isArray(t)?t.forEach((t,e)=>{s.html(t),s.attr("style","opacity: 1; top: 0px"),setTimeout(()=>s.attr("style","opacity: 0; top: 20px;"),1e3+500*e)}):(s.html(t),s.attr("style","opacity: 1; top: 0px"),setTimeout(()=>{s.attr("style","opacity: 0; top: 20px;")},1e3))}handleKeypress(t){this.pause||this.magnet.handleKeypress(t)}drawCoins(){for(let t=0;t<this.coins.length;t++){const s=this.coins[t];if(void 0!==s)if(s.collected)s.collect(),this.ctx.drawImage(s.image,s.x,s.y,40,40);else{for(let t=0;t<this.magnet.points.length;t++){const e=this.magnet.points[t];if(s.handleCollection(e)){this.collected.push(s.value),this.names.push(s.name),this.magnet.slowdown(s.slowdown);break}}this.ctx.drawImage(s.image,s.x,s.y,40,40)}}}startGame(){const t=$j("#start-button");t.html("Start"),$j("#game-over").attr("style","display: none; position: absolute;").find("p").html(""),$j("#score-input").attr("style","display: none;"),t.attr("style","display: block;")}gameOver(){clearInterval(this.gameInterval),this.clearCanvas(),this.showScoreInput(),this.showScore()}showScore(){const t=this.round>1?this.round+" rounds":"1 round",s=Math.round(100*this.money)/100;$j("#game-over").attr("style","display: flex;").find("p").html(`You lasted ${t}<br> and collected $${s}!`)}clearCanvas(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),$j("#pc").attr("style","display: none;"),$j("#pause-button").attr("style","display: none;"),this.music.pause(),this.ctx.cryptoMiner.setScoreboard(!0),$j("canvas").attr("style","background: url('./assets/images/sparkling_stars.gif') no-repeat; background-size: cover;")}showScoreInput(){$j("#score-input").attr("style","display: block;"),$j("input").val(),$j("#enter-score").attr("style","display: block;")}resetSelf(){this.ctx.cryptoMiner=new m(this.ctx,this.canvas)}}var u=m;var y=class{constructor(){this.highscoresHTML=$j("#highscores"),this.highScoresFromDB=[],this.highscoreToggle=this.highscoreToggle.bind(this),this.addListenerOnButton(),this.getScores=this.fetchScores(),this.makeHighscoresList(),this.updateScore=this.updateScore.bind(this),this.addListenerOnFetch(),setTimeout(this.updateScore,3e3)}highscoreToggle(){"display: block;"===this.highscoresHTML.attr("style")?this.highscoresHTML.attr("style","display: none;"):this.highscoresHTML.attr("style","display: block;")}addListenerOnButton(){$j("#highscore-button").on("click",this.highscoreToggle)}fetchScores(){return firebase.database().ref("scores/").orderByChild("round").limitToLast(5)}makeHighscoresList(t){if(this.highscoresHTML){this.highscoresHTML.html("<h3>High Scores</h3 >"),t&&this.highScoresFromDB.push(t),this.sortByRoundAndMoney();for(let t=0;t<5;t++){const s=this.highScoresFromDB[t];if(!s)break;this.highscoresHTML.html(this.highscoresHTML.html()+`<li><div class='score' ><h4><i class="fas fa-star shiny"></i>${t+1}. `+s[1])}}}sortByRoundAndMoney(){this.highScoresFromDB=this.sortByMoney(this.sortByRound()),this.keepOnlyFiveHighscores()}sortByRound(){const t={},s=this.highScoresFromDB;if(!s.length)return!1;for(let e=0;e<s.length;e++){const i=s[e];t[i[0]]||(t[i[0]]=[]),t[i[0]].push(i)}return t}sortByMoney(t){let s=[];if(!t)return[];const e=Object.keys(t).sort().reverse();for(let i=0;i<e.length&&!(s.length>=5);i++)t[e[i]].sort((t,s)=>s[2]-t[2]),s=s.concat(t[e[i]]);return s}keepOnlyFiveHighscores(){this.highScoresFromDB=this.highScoresFromDB.filter((t,s)=>s<5)}addListenerOnFetch(){this.getScores.on("child_added",t=>{const s=t.val(),e=`${s.name.slice(0,10)}</h4><h5>Rounds: ${s.round} Money: $${s.money}</h5></div></li>`;this.highScoresFromDB.length<5?(this.highScoresFromDB.push([s.round,e,s.money]),5===this.highScoresFromDB.length&&(this.highScoresFromDB=this.highScoresFromDB.reverse(),this.makeHighscoresList())):this.makeHighscoresList([s.round,e,s.money])})}updateScore(){this.highScoresFromDB.length<5?(this.getScores=this.fetchScores(),setTimeout(this.updateScore,3e3)):setTimeout(this.updateScore,6e4)}};document.addEventListener("DOMContentLoaded",()=>{!function(){o();const t=$j("#game-frame").nodes[0],s=$j("#start-button"),e=$j("#pause-button"),i=$j("#game-over"),a=$j("#mute");let h;const n=$j("#more-menu");if($j("#show-more").on("click",()=>n.attr("style","display: block;")),n.find("a").on("click",()=>n.attr("style","display: none;")),new y,t.getContext){const o=t.getContext("2d");o.cryptoMiner=new u(o,t),o.cryptoMiner.startGame(),o.playMusic=!0;const n=()=>{s.attr("style","display: block; left: 173px;").html("Unpause"),e.attr("style","display: none;"),o.cryptoMiner.music.pause(),o.cryptoMiner.pause=!0,clearInterval(o.cryptoMiner.gameInterval)},r=t=>{o.cryptoMiner.handleKeypress(t.key)},c=[t,s.nodes[0],e.nodes[0],i.nodes[0],a.nodes[0],a.children().nodes[0]];document.addEventListener("keydown",t=>{c.includes(h)&&r(t)},!1),document.addEventListener("mousedown",t=>{h=t.target,c.includes(h)||"display: block;"===s.attr("style")||n()},!1);const l=()=>{$j("#panel").attr("style","display: block;"),$j("#pc").attr("style","display: block;"),o.fillStyle="#010014",o.fillRect(0,0,t.width,t.height),o.fill(),e.attr("style","display: block;"),$j("canvas").attr("style","background: url('./assets/images/moving_stars.gif') no-repeat; background-size: cover;"),s.attr("style","display: none;"),o.cryptoMiner.pause=!1,o.cryptoMiner.gameInterval=setInterval(()=>o.cryptoMiner.play(),17)};s.on("click",l),e.on("click",n),document.addEventListener("keypress",t=>{console.log(t.key,s.html()),"p"===t.key&&o.cryptoMiner.gameInterval?o.cryptoMiner.pause?l():n():"m"===t.key?o.playMusic=!o.playMusic:"r"===t.key?(o.cryptoMiner.gameOver(),o.cryptoMiner.resetSelf(),o.cryptoMiner.startGame()):"Enter"===t.key&&"Start"===s.html()&&"display: block;"===s.attr("style")&&l()}),$j("#mute").on("click",()=>{o.playMusic=!o.playMusic});const d=(t,s)=>{const e={};e.name=document.getElementById("input").value.toUpperCase(),0===e.name.length&&(e.name="???"),e.money=Math.round(100*t)/100,e.round=s,firebase.database().ref("scores/").push(e)};$j("#game-over").find("b").on("click",()=>{o.cryptoMiner.resetSelf(),o.cryptoMiner.startGame()}),$j("#score-input").on("submit",t=>{t.preventDefault(),d(o.cryptoMiner.money,o.cryptoMiner.round),o.cryptoMiner.resetSelf(),o.cryptoMiner.startGame()}),$j("#game-over").find("b").on("mouseover",()=>{$j("#game-over").find("b").html("RESTART")}),$j("#game-over").find("b").on("mouseout",()=>{$j("#game-over").find("b").html("GAME OVER")})}}()})}]);
//# sourceMappingURL=bundle.js.map